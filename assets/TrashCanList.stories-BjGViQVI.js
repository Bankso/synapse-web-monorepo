import{aD as b,as as C,aE as v,a9 as S,r as c,j as t,h6 as q,X as x,e5 as Q,c3 as P,V as K,B as g,dq as V,dP as z,dO as O}from"./iframe-YNORiRmR.js";import{u as A}from"./useInfiniteQuery-DDQOECX-.js";import{g as H}from"./InfiniteQueryUtils-CKlRW-xB.js";import{u as Y,S as W,c as _,g as G}from"./StyledTanStackTable-CFILm036.js";import{C as X,a as J}from"./EntityHeaderTableCellRenderers-Dvl9f2Di.js";import{E as U}from"./EntityLink-CSWP5Xgw.js";import{W as Z}from"./WarningDialog-Dx3hWpW0.js";import"./index-r8ZA1smB.js";import"./StyledTableContainer-C6LSLMPN.js";import"./ExpandCollapseButton-HKXS3ljs.js";import"./index-CsPBkyy4.js";import"./Checkbox-C9i_hBz8.js";import"./SwitchBase-0eQkQMrp.js";import"./useEntity-CSu2QEQP.js";import"./pickBy-rr4lLDZz.js";import"./isString-CBX5AqAy.js";import"./_baseIteratee-BgQd_HJ1.js";import"./useQueries-BhKGWhSp.js";import"./queryOptions-C9woPjwX.js";import"./useEntityBundle-DoscKK1e.js";import"./useGetEntityHeaders-CHUs91za.js";import"./EntityIcon-BE1L0-SL.js";import"./ErrorChip-B4rksfPO.js";import"./Chip-DuirGYLs.js";import"./ConfirmationDialog-hAi2Tj4J.js";import"./DialogBase-iLRY9fRC.js";import"./Close-Bti9lGnZ.js";import"./HelpPopover-D5YAnV4f.js";import"./MarkdownPopover-z-2DvCPX.js";import"./LightTooltip-B6SUVl9G.js";import"./MarkdownSynapse-gLVhWgk-.js";import"./SkeletonButton-CDu-p3fM.js";import"./SkeletonInlineBlock-DuGmV4aM.js";import"./SkeletonTable-BD0sK0Ta.js";import"./SkeletonParagraph-EPv1fXrq.js";function $(r){const{accessToken:e,keyFactory:i}=C();return A({...r,queryKey:i.getTrashCanItemsQueryKey(),queryFn:l=>S.getItemsInTrashCan(e,l.pageParam),initialPageParam:void 0,getNextPageParam:H})}function ee(r){const e=b(),{accessToken:i,keyFactory:l}=C();return v({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>S.restoreFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r!=null&&r.onSuccess&&await r.onSuccess(a,s,o)}})}function te(r){const e=b(),{accessToken:i,keyFactory:l}=C();return v({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>S.purgeFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r!=null&&r.onSuccess&&await r.onSuccess(a,s,o)}})}function re(r){return r.filter(e=>e.status==="rejected").map(e=>e.reason)}const m=_();function ae(r){return[{id:"select",header:J,cell:X,maxSize:50},m.accessor("entityId",{header:"ID"}),m.accessor("entityName",{header:"Name"}),m.accessor("entityType",{header:"Entity Type",cell:e=>V(e.getValue())}),m.accessor("originalParentId",{header:"Location",cell:e=>t.jsxs(t.Fragment,{children:[e.getValue()&&t.jsx(U,{entity:e.getValue()})," (",e.getValue(),")"]}),size:200}),m.accessor("deletedOn",{header:"Deleted On",cell:e=>z(O(e.getValue()))}),{id:"restoreButton",header:"",cell:({row:e})=>t.jsx(g,{size:"small",variant:"outlined",onClick:()=>{r(e.original.entityId),e.toggleSelected(!1)},children:"Restore"}),maxSize:100}]}function ne(){const[r,e]=c.useState(!1),[i,l]=c.useState([]),[a,s]=c.useState({});function o(n,w){n?l(re(n)):w&&l([w]),s({})}const{mutate:p,isPending:E}=ee({onSettled:o}),{mutate:F,isPending:T}=te({onSettled:o}),D=E||T,{data:u,isLoading:h,hasNextPage:M,fetchNextPage:B,isFetchingNextPage:L}=$({throwOnError:!0}),f=c.useMemo(()=>(u==null?void 0:u.pages.flatMap(n=>n.results))??[],[u]),N=c.useMemo(()=>ae(n=>{p(n)}),[p]),j=Y({data:f,columns:N,state:{rowSelection:a},getRowId:n=>n.entityId,enableRowSelection:!0,onRowSelectionChange:s,getCoreRowModel:G(),columnResizeMode:"onChange"}),d=j.getSelectedRowModel().rows.map(n=>n.original.entityId);return t.jsxs("div",{children:[t.jsx(q,{show:D,headlineText:T?"Deleting...":"Restoring..."}),t.jsx(x,{variant:"body1",children:'The trash can contains items that were recently deleted. You can recover deleted items in the trash can by clicking "Restore". Items will remain in the trash can for 30 days before being automatically purged.'}),t.jsx(Z,{title:"Delete selected items from your Trash?",content:t.jsx(x,{variant:"body1",children:"You can't undo this action."}),confirmButtonText:"Delete",confirmButtonColor:"error",onConfirm:()=>{F(d),e(!1)},onCancel:()=>{e(!1)},open:r}),h&&t.jsx(Q,{}),!h&&f.length===0&&t.jsx(P,{severity:"info",sx:{my:2},children:t.jsx(x,{variant:"body1",children:"Your trash can is currently empty."})}),!h&&f.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(W,{table:j,styledTableContainerProps:{sx:{my:4}}}),i.length>0&&t.jsxs(P,{severity:"error",sx:{mb:1},children:["The following errors were encountered:",t.jsx("ul",{style:{marginBottom:0},children:i.map(n=>t.jsx("li",{children:n.message},n.message))})]}),t.jsxs(K,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[M&&t.jsx(g,{variant:"contained",disabled:L,onClick:()=>{B()},children:"Load More"}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(g,{variant:"contained",color:"error",disabled:d.length===0,onClick:()=>{e(!0)},children:"Delete Selected"}),t.jsx(g,{variant:"outlined",disabled:d.length===0,onClick:()=>{p(d)},children:"Restore Selected"})]})]})]})}const Ve={title:"Synapse/TrashCanList",component:ne},y={};var I,R,k;y.parameters={...y.parameters,docs:{...(I=y.parameters)==null?void 0:I.docs,source:{originalSource:"{}",...(k=(R=y.parameters)==null?void 0:R.docs)==null?void 0:k.source}}};const ze=["TrashCan"];export{y as TrashCan,ze as __namedExportsOrder,Ve as default};
