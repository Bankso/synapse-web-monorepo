!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).markdownitSynapse=e()}(function(){return function o(a,i,p){function u(r,e){if(!i[r]){if(!a[r]){var n="function"==typeof require&&require;if(!e&&n)return n(r,!0);if(c)return c(r,!0);var t=new Error("Cannot find module '"+r+"'");throw t.code="MODULE_NOT_FOUND",t}var s=i[r]={exports:{}};a[r][0].call(s.exports,function(e){return u(a[r][1][e]||e)},s,s.exports,o,a,i,p)}return i[r].exports}for(var c="function"==typeof require&&require,e=0;e<p.length;e++)u(p[e]);return u}({1:[function(e,r,n){"use strict";var h,c,k,l,d,y,f=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g,C=new RegExp("^syn([0-9]+[.]?[0-9]*)+"),b=new RegExp("^([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\/w \\.-]*)*\\/?.*$"),A=new RegExp("^doi:10[.]{1}[0-9]+[/]{1}[a-zA-Z0-9_.]+$"),g=new RegExp("^\\s*(width[=]{1})?\\s*(.*)[}]{1}\\s*$"),x=new RegExp('^\\s*(text[=]{1}["]{1})?\\s*(.*)["]{1}[}]{1}\\s*$'),i=new RegExp("^\\s*[*-+>]{1}[^|]*$"),p=new RegExp("^\\s*\\w+\\s*[.)]{1}[^|]*$"),u=new RegExp("^\\s*[`]{3}s*([a-zA-Z_0-9-]*)s*$");function m(e){if(8192<=e&&e<=8202)return 1;switch(e){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return 1}}function t(e,r){var n,t,s,o,a,i=e.posMax,p=e.pos,u="widgetContainer";if(i<=p+3)return!1;if(r)return!1;if(64===e.src.charCodeAt(p)){if(0<p&&!m(e.src.charCodeAt(e.pos-1)))return!1;for(;e.pos<i&&!m(e.src.charCodeAt(e.pos))&&function(e){if(65<=e&&e<=90)return 1;if(48<=e&&e<=57)return 1;if(97<=e&&e<=122)return 1;switch(e){case 64:case 46:case 45:case 95:return 1}}(e.src.charCodeAt(e.pos));)e.pos++;return t=e.src.slice(p+1,e.pos),e.posMax=e.pos,e.pos=p,(s=e.push("synapse_open","span",1)).markup="@",s.attrs=[["data-widgetparams","badge?alias="+t],["data-widget-type","badge"],["class",u],["id","widget-"+c+h]],(s=e.push("link_open","a",1)).attrs=[["href","https://www.synapse.org/Portal/aliasredirector?alias="+t]],s.markup="autolink",s.info="auto",(s=e.push("text","",0)).content="@"+t,(s=e.push("link_close","a",-1)).markup="autolink",s.info="auto",s=e.push("text","",0),s=e.push("synapse_close","span",-1),e.pos=e.posMax,e.posMax=i,c+=1,!0}if(36!==e.src.charCodeAt(p))return!1;if(123!==e.src.charCodeAt(p+1))return!1;for(e.pos=p+2;e.pos<i;){if(125===e.src.charCodeAt(e.pos)){n=!0;break}e.md.inline.skipToken(e)}return n&&p+2!==e.pos?(o=(t=e.src.slice(p+2,e.pos)).replace(f,"$1"),0===t.lastIndexOf("reference?",0)?(o+="&footnoteId="+l,(s=e.push("synapse_reference_open","span",1)).attrs=[["id","wikiReference"+l]],s=e.push("synapse_reference_close","span",-1),(a=function(e,r){for(var n,t=null,s=e.split("?")[1].split("&"),o=0;o<s.length;o++)r===(n=s[o].split("="))[0]&&(t=n[1]);return t}(decodeURIComponent(o),"text"))&&(d+="${bookmark?text=["+l+"]&bookmarkID=wikiReference"+l+"} "+a+"\n"),l++,u="inlineWidgetContainer"):0===t.lastIndexOf("bookmark?",0)&&((s=e.push("synapse_footnote_target_open","span",1)).attrs=[["id","wikiFootnote"+l]],s=e.push("synapse_footnote_target_close","span",-1),l++,u="inlineWidgetContainer"),e.posMax=e.pos,e.pos=p+2,(s=e.push("synapse_open","span",1)).markup="${",s.attrs=[["data-widgetparams",o],["class",u],["id","widget-"+c+h],["data-widget-type",o.substring(0,o.indexOf("?"))]],(s=e.push("text","",0)).content="<Synapse widget>",(s=e.push("synapse_close","span",-1)).markup="}",e.pos=e.posMax+1,e.posMax=i,c+=1,!0):(e.pos=p,!1)}r.exports=function(e,r,n){k=c=0,l=1,h=r,y=d="",n&&(y=n),e.inline.ruler.after("emphasis","synapse",t)},r.exports.footnotes=function(){return d},r.exports.resetFootnotes=function(){d="",l=1},r.exports.preprocessMarkdown=function(e){for(var r="",n=e.split("\n"),t=!1,s=!1,o=!1,a=0;a<n.length;a++)u.test(n[a])&&(o=!o),o||(s=i.test(n[a])||p.test(n[a]),t&&!s&&(r+="\n"),t=s),r+=n[a]+"\n";return r},r.exports.init_markdown_it=function(_,e,r,n,t,s,o,a,i,p,u){function c(){var c=_.renderer.rules.link_open||function(e,r,n,t,s){return s.renderToken(e,r,n)};_.renderer.rules.link_open=function(e,r,n,t,s){var o,a,i,p=e[r].attrIndex("target"),u=e[r].attrIndex("href");return p<0?(u<0||(o=e[r].attrs[u][1],a="#!",i=i||0,o.substr(i,a.length)!==a))&&(e[r].attrPush(["target","_blank"]),e[r].attrPush(["ref","noopener noreferrer"])):(e[r].attrs[p][1]="_blank",e[r].attrPush(["ref","noopener noreferrer"])),c(e,r,n,t,s)}}function l(e,r){var n,t,s,o,a,i,p,u,c="",l=e.pos,d=e.posMax,f=e.pos,h=_.helpers.parseLinkLabel,k=_.helpers.parseLinkDestination,g=_.helpers.parseLinkTitle,x=_.utils.isSpace,m=_.utils.normalizeReference;if(91!==e.src.charCodeAt(e.pos))return!1;if(a=e.pos+1,(o=h(e,e.pos,!0))<0)return!1;if((i=o+1)<d&&40===e.src.charCodeAt(i)){for(i++;i<d&&(x(t=e.src.charCodeAt(i))||10===t);i++);if(d<=i)return!1;var v,w,f=i;for((w=k(e.src,i,e.posMax)).ok&&(v=w.str,C.test(v)?w.str=y+"#!Synapse:"+v.replace(/[.]/,"/version/"):b.test(v)?w.str="http://"+v:A.test(v)&&(w.str="http://dx.doi.org/"+v),c=e.md.normalizeLink(w.str),e.md.validateLink(c)?i=w.pos:c=""),f=i;i<d&&(x(t=e.src.charCodeAt(i))||10===t);i++);if(w=g(e.src,i,e.posMax),i<d&&f!==i&&w.ok)for(u=w.str,i=w.pos;i<d&&(x(t=e.src.charCodeAt(i))||10===t);i++);else u="";if(d<=i||41!==e.src.charCodeAt(i))return e.pos=l,!1;i++}else{if(void 0===e.env.references)return!1;if(i<d&&91===e.src.charCodeAt(i)?(f=i+1,0<=(i=h(e,i))?s=e.src.slice(f,i++):i=o+1):i=o+1,s=s||e.src.slice(a,o),!(p=e.env.references[m(s)]))return e.pos=l,!1;c=p.href,u=p.title}return r||(e.pos=a,e.posMax=o,e.push("link_open","a",1).attrs=n=[["href",c]],u&&n.push(["title",u]),e.md.inline.tokenize(e),e.push("link_close","a",-1)),e.pos=i,e.posMax=d,!0}function d(e,r){var n,t,s=e.pos,o=e.src.charCodeAt(s);if(r)return!1;if(95!==o&&42!==o)return!1;for(t=function(e,r,n){for(var t=n,s=r,o=e.charCodeAt(n);t<s&&e.charCodeAt(t)===o;)t++;return{can_open:!0,can_close:!0,length:t-n}}(e.src,e.posMax,e.pos),n=0;n<t.length;n++)e.push("text","",0).content=String.fromCharCode(o),e.delimiters.push({marker:o,jump:n,token:e.tokens.length-1,level:e.level,end:-1,open:t.can_open,close:t.can_close});return e.pos+=t.length,!0}var f;_.set({html:!0,breaks:!0,linkify:!0,maxNesting:100}),_.disable(["heading"]),_.disable(["lheading"]),e&&_.use(e),r&&_.use(r),n&&_.use(n),t&&_.use(t),s&&_.use(s),o&&_.use(o),i&&_.use(i),p&&_.use(p),u&&_.use(u),a&&(_.use(a,"row",{marker:"{row}",minMarkerCount:1,render:function(e,r){var n=1===e[r].nesting?'<div class="container-fluid"><div class="row">':"</div></div>\n";return n},validate:function(){return!0}}),_.use(a,"column",{marker:"{column",endMarker:"{column}",minMarkerCount:1,render:function(e,r){var n,t=1===e[r].nesting?(n=g.exec(e[r].info),'<div class="col-sm-'+_.utils.escapeHtml(n[2])+'">'):"</div>\n";return t},validate:function(e){return g.test(e)}}),_.use(a,"nav",{marker:"{nav",endMarker:"{nav}",minMarkerCount:1,render:function(e,r){var n,t;return 1===e[r].nesting?(n=x.exec(e[r].info),t='<div id="nav-target-'+k+h+'" target-text="'+_.utils.escapeHtml(n[2])+'">',k+=1):t="</div>\n",t},validate:function(e){return x.test(e)}})),c(),_.linkify.set({fuzzyLink:!1}),_.linkify.add("syn",{validate:function(e,r,n){var t=e.slice(r);return n.re.synapse||(n.re.synapse=new RegExp("^([0-9]{3,}[.]?[0-9]*(\\/wiki\\/[0-9]+)?)+(?!_)(?=$|"+n.re.src_ZPCc+")")),n.re.synapse.test(t)?t.match(n.re.synapse)[0].length:0},normalize:function(e){e.url=y+"#!Synapse:"+e.url.replace(/[.]/,"/version/")}}),_.linkify.add("doi:10.",{validate:function(e,r,n){var t=e.slice(r);return n.re.doi||(n.re.doi=new RegExp("^[0-9]+[/]{1}[a-zA-Z0-9_.]+(?!_)(?=$|"+n.re.src_ZPCc+")")),n.re.doi.test(t)?t.match(n.re.doi)[0].length:0},normalize:function(e){e.url="https://doi.org/"+e.url}}),f=_.renderer.rules.table_open||function(e,r,n,t,s){return s.renderToken(e,r,n)},_.renderer.rules.table_open=function(e,r,n,t,s){var o=e[r].attrIndex("class");return o<0?e[r].attrPush(["class","markdowntable"]):e[r].attrs[o][1]+=" markdowntable",f(e,r,n,t,s)},_.inline.ruler.at("link",l),_.inline.ruler.at("emphasis",d)}},{}]},{},[1])(1)});
